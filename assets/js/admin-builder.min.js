/*! Pace Builder - v1.1.4 - 2016-11-25
 * Copyright (c) 2016; 
 * Licensed GPLv2+ */
var ptPbApp=ptPbApp||{};!function($,_){String.prototype.toProperCase=function(){return this.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})},ptPbApp.template=_.memoize(function(id){var compiled,options={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g};return function(data){try{return"module-header"!=id&&id.match(/module-/)&&(data=_.extend({},ptPbOptions.formFields.modules[id.replace("module-","").replace("-edit","")]||{},data)),(compiled=compiled||_.template($("#pt-pb-tmpl-"+id).html(),null,options))({data:data})}catch(e){if(console&&console.error&&!$("#pt-pb-tmpl-"+id).length)return void console.error('Template "#pt-pb-tmpl-'+id+'" does not exist.');console&&console.error&&console.error(e)}}}),ptPbApp.partial=function(which,data){return ptPbApp.template(which)(data)},ptPbApp.generateOption=function(selected,value,name,attr,optgroup){return name||(name=value),attr||(attr=""),'<option value="'+value+'" '+(value===selected?"selected":"")+" "+attr+">"+name+"</option>"},ptPbApp.getInputPrefix=function(id){return(id.split("__").join("][")+"]").replace("pt_pb_section]","pt_pb_section")},ptPbApp.serializeElms=function(elm){var arr=elm.serializeObject(),result={};return $.each(arr,function(i,v){var n=i.split("][").slice(-1)[0].replace("]","")||"nn";result[n]=v}),result},ptPbApp.stripslashes=function(str){return(str+"").replace(/\\(.?)/g,function(s,n1){switch(n1){case"\\":return"\\";case"0":return"\x00";case"":return"";default:return n1}})},ptPbApp.htmlEncode=function(value){return String(ptPbApp.stripslashes(value)).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},ptPbApp.isUrl=function(s){var regexp=/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return regexp.test(s)},ptPbApp.slug=function(name){return name.replace(/[&\/\\#,+()$~%.'":*?<>{}\s]/g,"-").toLowerCase()}}(jQuery,_);var ptPbApp=ptPbApp||{};ptPbApp.Models=ptPbApp.Models||{},function(window,Backbone,$,_,ptPbApp){"use strict";ptPbApp.Models.Filter=Backbone.Model.extend({defaults:{what:"",where:""},initialize:function(opts){this.collection=opts.collection,this.filtered=new Backbone.Collection(opts.collection.models),this.on("change:what change:where",this.filter)},filter:function(){var models,what=this.get("what").trim(),where=this.get("where"),lookin=""===where?_.keys(this.collection.models[0].attributes):where;models=""===what?this.collection.models:this.collection.filter(function(model){return _.some(_.values(model.pick(lookin)),function(value){return"string"==typeof value?~value.toLowerCase().indexOf(what.toLowerCase()):void 0})}),this.filtered.reset(models)}}),ptPbApp.Models.Base=Backbone.Model.extend({defaults:{f_e:!1,fh_c:"",fh_f:"inherit",fh_v:"normal",fh_s:"32px",fh_lh:"1.5em",fh_ls:"0",fh_ws:"0",fh_b:0,fh_i:0,fh_u:0,ft_c:"",ft_f:"inherit",ft_v:"normal",ft_s:"13px",ft_lh:"1.5em",ft_ls:"0",ft_ws:"0",ft_b:0,ft_i:0,ft_u:0,fh_st:"32px",ft_st:"13px",fh_sm:"32px",ft_sm:"13px",f_tss:"768;991",f_mss:767},initialize:function(){this.on("change",ptPbApp.updatePBContent),this.on("remove",ptPbApp.updatePBContent)},toJSON:function(options){var json=Backbone.Model.prototype.toJSON.call(this);if(options&&options.clean){var opts=["fh_c","fh_f","fh_v","fh_s","fh_lh","fh_ls","fh_ws","fh_b","fh_i","fh_u","ft_c","ft_f","ft_v","ft_s","ft_lh","ft_ls","ft_ws","ft_b","ft_i","ft_u"],del=[];json.f_e?("inherit"==json.fh_f&&(del=del.concat(opts.slice(1,10))),"inherit"==json.ft_f&&(del=del.concat(opts.slice(11)))):del=opts,json.f_et||(del=del.concat(["f_tss","fh_st","ft_st"])),json.f_em||(del=del.concat(["f_mss","fh_sm","ft_sm"])),_.each(del,function(opt,i){opt in json&&delete json[opt]})}return json}}),ptPbApp.Models.PageOptions=ptPbApp.Models.Base.extend({defaults:function(){return _.extend({fullwidth:"no",layout:"default"},ptPbApp.Models.Base.prototype.defaults)},initialize:function(){this.on("change",ptPbApp.updatePBOptions),this.on("remove",ptPbApp.updatePBOptions)}}),ptPbApp.Models.Section=ptPbApp.Models.Base.extend({defaults:function(){return _.extend({id:"",css_class:"",pt:"30px",pb:"30px",btw:"0px",bbw:"0px",btc:"",bbc:""},ptPbOptions.formFields.section,ptPbApp.Models.Base.prototype.defaults)},initialize:function(){ptPbApp.Models.Base.prototype.initialize.call(this),_.defaults(this,{rows:new ptPbApp.Collections.Row([],{parent:this}),rowNum:1}),this.get("id")||this.set("id",ptPbApp.getSectionNum()),this.on("ptpb:add:row",function(row,ind){this.add(row,{at:ind})}),this.on("ptpb:clone:row",function(row,ind){this.add(row,{at:ind})})},add:function(attr,options){var id=this.getRowId();return this.rows.add(_.extend(attr,{id:id}),_.extend({parse:!0},options||{}))},parse:function(response){var section=this;return this.rowNum=1,response.id=ptPbApp.getSectionNum(),_.has(response,"rows")&&(response.rows=_.isObject(response.rows)?_.map(response.rows,function(v,k){return v}):response.rows,response.rows=response.rows.map(function(row){return row.id=section.getRowId(response.id),row}),this.rows=new ptPbApp.Collections.Row(response.rows,{parse:!0,parent:this})),response},toJSON:function(options){var json=ptPbApp.Models.Base.prototype.toJSON.call(this,options);return json.rows=this.rows.toJSON(options),json},getRowId:function(id){return(id||this.get("id"))+"_r"+this.rowNum++}}),ptPbApp.Models.Row=ptPbApp.Models.Base.extend({defaults:function(){return _.extend({id:"",pt:"0px",pb:"0px",pl:"0px",pr:"0px"},ptPbOptions.formFields.row,ptPbApp.Models.Base.prototype.defaults)},initialize:function(){if(ptPbApp.Models.Base.prototype.initialize.call(this),_.defaults(this,{columns:new ptPbApp.Collections.Column([],{parent:this}),colNum:1}),this.on("ptpb:update:row",this.updateColumns),this.get("layout")){var model=this;_.each(this.get("layout"),function(col){model.add({type:col})}),this.unset("layout")}},add:function(attr){return this.columns.add(_.extend(attr,{id:this.getColumnId()}))},updateColumns:function(options){var row=this.toJSON(),columns=options.layout.map(function(layout,i){return _.extend(row.columns[i]||{},{type:layout})});this.columns.reset(columns,{parse:!0})},parse:function(response){var row=this;return this.colNum=1,_.has(response,"columns")&&(response.columns=_.isObject(response.columns)?_.map(response.columns,function(v,k){return v}):response.columns,response.columns=response.columns.map(function(column){return column.id=row.getColumnId(response.id),column}),this.columns=new ptPbApp.Collections.Column(response.columns,{parse:!0,parent:this})),response},toJSON:function(options){var json=ptPbApp.Models.Base.prototype.toJSON.call(this,options);return json.columns=this.columns.toJSON(options),json},getColumnId:function(id){return(id||this.get("id"))+"_c"+this.colNum++}}),ptPbApp.Models.Column=ptPbApp.Models.Base.extend({defaults:function(){return _.extend({id:"",type:"1-1",pl:"15px",pr:"15px",pt:"0px",pb:"0px",blw:"0px",brw:"0px",blc:"",brc:"",css_class:""},ptPbOptions.formFields.column,ptPbApp.Models.Base.prototype.defaults)},initialize:function(){ptPbApp.Models.Base.prototype.initialize.call(this),_.defaults(this,{modules:new ptPbApp.Collections.Module([],{parent:this}),modNum:1}),this.on("ptpb:add:module",function(module,ind){this.add(module,{at:ind})}),this.on("ptpb:clone:module",function(module,ind){this.add(module,{at:ind})})},add:function(attr,options){var column=this;return this.modules.add(_.extend({},column.getModuleDefaults(attr),attr,{id:this.getModuleId(),type:attr.module,widget:attr.widget||!1}),_.extend({parse:!0},options||{}))},getModuleDefaults:function(attr){return attr&&"widget"===attr.module?ptPbOptions.widgets[attr.widget]||{}:ptPbOptions.formFields.modules[attr.module]||{}},parse:function(response){var column=this;return this.modNum=1,_.has(response,"modules")&&(response.modules=_.isObject(response.modules)?_.map(response.modules,function(v,k){return v}):response.modules,response.modules=response.modules.map(function(module){return _.extend({},column.getModuleDefaults(module),module,{id:column.getModuleId(response.id)})}),this.modules=new ptPbApp.Collections.Module(response.modules,{parse:!0,parent:this})),response},toJSON:function(options){var json=ptPbApp.Models.Base.prototype.toJSON.call(this,options);return json.modules=this.modules.toJSON(options),json},getModuleId:function(id){return(id||this.get("id"))+"_m"+this.modNum++}}),ptPbApp.Models.Module=ptPbApp.Models.Base.extend({defaults:function(){return _.extend({mb:"20px",pt:"0px",pb:"0px",pl:"0px",pr:"0px",animation:""},ptPbApp.Models.Base.prototype.defaults)},initialize:function(){ptPbApp.Models.Base.prototype.initialize.call(this),_.defaults(this,{items:new ptPbApp.Collections.Item([],{parent:this}),itemNum:1}),this.on("ptpb:clone:item",function(item,ind){this.add(item,{at:ind})})},getItemDefaults:function(attr){return ptPbOptions.formFields.items[attr||this.get("type")]||{}},toJSON:function(options){var json=ptPbApp.Models.Base.prototype.toJSON.call(this,options);return this.get("hasItems")&&(json.items=this.items.toJSON(options)),json},parse:function(response){var module=this,typ=module.get("item");return this.itemNum=1,_.has(response,"items")&&(response.items=_.isObject(response.items)?_.map(response.items,function(v,k){return v}):response.items,response.items=response.items.map(function(item){return _.extend({},module.getItemDefaults(typ),item,{id:module.getItemId(response.id),type:typ})}),this.items=new ptPbApp.Collections.Item(response.items,{parent:this})),response},getItemId:function(id){return(id||this.get("id"))+"_i"+this.itemNum++},add:function(attr,options){return this.items.add(_.extend(this.getItemDefaults(),attr,{id:this.getItemId(),type:this.get("type")}),options||{})}})}(window,Backbone,jQuery,_,ptPbApp);var ptPbApp=ptPbApp||{};ptPbApp.Collections=ptPbApp.Collections||{},function(window,Backbone,$,_,ptPbApp){"use strict";ptPbApp.Collections.Base=Backbone.Collection.extend({initialize:function(models,options){this.on("change reset add remove update sort",ptPbApp.updatePBContent),this.parent=options&&options.parent?options.parent:null}}),ptPbApp.Collections.Section=Backbone.Collection.extend({model:ptPbApp.Models.Section,initialize:function(models,options){this.on("change reset add remove update sort",ptPbApp.updatePBContent)}}),ptPbApp.Collections.Row=ptPbApp.Collections.Base.extend({model:ptPbApp.Models.Row}),ptPbApp.Collections.Column=ptPbApp.Collections.Base.extend({model:ptPbApp.Models.Column}),ptPbApp.Collections.Module=ptPbApp.Collections.Base.extend({model:ptPbApp.Models.Module}),ptPbApp.Collections.Item=ptPbApp.Collections.Base.extend({})}(window,Backbone,jQuery,_,ptPbApp);var ptPbApp=ptPbApp||{};ptPbApp.Views=ptPbApp.Views||{},ptPbApp.Behaviors=ptPbApp.Behaviors||{},function(window,Backbone,$,_,ptPbApp){"use strict";ptPbApp.Behaviors.Sortable=Marionette.Behavior.extend({onRender:function(){var collection=this.view.collection;this.$el.sortable({distance:5,forcePlaceholderSize:!0,forceHelperSize:!0,placeholder:"sortable-placeholder-pt-pb",axis:this.options.axis||!1,grid:this.options.grid||!1,containment:this.options.containment||!1,cursor:"move",handle:this.options.handle||!1,revert:this.options.revert||!1,connectWith:this.options.connectWith||!1,update:function(event,ui){if(this==ui.item.parent()[0]&&null==ui.sender){var model=collection.get(ui.item.attr("id"));collection.remove(model,{silent:!0}),collection.add(model,{at:ui.item.index(),silent:!0}),ptPbApp.updatePBContent()}else if(this!==ui.item.parent()[0])ptPbApp.senderCollection=collection;else if(this==ui.item.parent()[0]&&null!=ui.sender){var model=ptPbApp.senderCollection.get(ui.item.attr("id"));ptPbApp.senderCollection.remove(model),collection.parent.add(model.toJSON(),{at:ui.item.index()})}},start:this.options.start||function(){},over:this.options.over||function(){}})}}),ptPbApp.Views.Filter=Backbone.View.extend({render:function(){var html,$newel,$oldel=this.$el;return html=this.html(),$newel=$(html),this.setElement($newel),$oldel.replaceWith($newel),this},initialize:function(opts){this.template=opts.template,this.listenTo(this.collection,"reset",this.render)},html:function(){return this.template({models:this.collection.toJSON()})}}),ptPbApp.Views.FilterForm=Backbone.View.extend({events:{'keyup input[name="q"]':_.throttle(function(e){this.model.set("what",e.currentTarget.value)},200)},className:"pt-pb-filter-form",render:function(){return this.$el.html('<form><input type="text" placeholder="Search.." name="q" /></form>'),this}}),Backbone.Modal.prototype.keyControl=!1,ptPbApp.Views.Modal=Backbone.Modal.extend({onRender:function(){this.$el.append('<a class="close-bbm-modal">×</a>'),this.tabs()},onShow:function(){this.$(".pt-sidebar-tabs li a, .pt-topbar-tabs li a").first().trigger("click")},tabs:function(){this.$(".pt-sidebar-tabs, .pt-topbar-tabs").off("click","li a").on("click","li a",function(e){e.preventDefault();var $t=$(e.target),li=$t.parent(),lis=li.siblings("li"),href=$t.attr("href"),pane=$(href),panes=pane.parent().find(".pt-tab-pane");lis.removeClass("tab-active"),li.addClass("tab-active"),panes.removeClass("open"),pane.addClass("open").trigger("pt-tab:open")})},showLoader:function($elm){$elm.append('<div class="pt-pb-loader"><div class="pt-pb-spinner"></div></div>')},removeLoader:function($elm){$elm.find(".pt-pb-loader").remove()}}),ptPbApp.Views.Dialog=ptPbApp.Views.Modal.extend({events:{"click .button-primary":"triggerSubmit","click .close-model":"triggerCancel","click .close-bbm-modal":"triggerCancel"},initialize:function(options){this.template=ptPbApp.template(options.template),options.filter&&(this.filterTemplate=options.filter.template,this.filterCollection=options.filter.collection,this.filterAppendTo=options.filter.appendTo,this.filterModel=options.filter.model,this.filterFormAppendTo=options.filter.formAppendTo)},onDestroy:function(){ptPbApp.removeEditor()},onRender:function(){if(ptPbApp.Views.Modal.prototype.onRender.call(this),this.unSavedData=this.$(":input:not(button, .button)").serializeObject(),this.$content=this.$("input[name=content]"),ptPbApp.createEditor(this.$content),this.bindEvents(),"widget"===this.model.get("type")&&this.widgetForm(),this.filterTemplate){var view=this,filterform=new ptPbApp.Views.FilterForm({model:view.filterModel}),filterView=new ptPbApp.Views.Filter({template:ptPbApp.template(view.filterTemplate),collection:view.filterCollection});this.$(view.filterFormAppendTo).append(filterform.render().el),this.$(view.filterAppendTo).append(filterView.render().el)}},submit:function(e){var data=this.$(":input:not(button, .button)").serializeObject();this.$(":checkbox:not(:checked)").map(function(){data[this.getAttribute("name")]=!1}),this.$content.length>0&&(data.content=ptPbApp.getContent(),delete data.ptpb_editor),this.$chosens&&this.$chosens.length&&this.$chosens.each(function(){var $c=$(this),name=$c.attr("name").replace("[","").replace("]","");data[name]||(data[name]="")}),this.model.set(data)},widgetForm:function(update){var view=this,$elm=view.$("#pt-form-module-settings"),data={action:"ptpb_widget_form",widget:this.model.get("widget"),instance:JSON.stringify(this.model.toJSON().instance),update:!!update};this.showLoader($elm),$.post(ptPbOptions.ajaxurl,data,function(result){$elm.prepend(result).addClass("widget-edit"),view.removeLoader($elm)},"html")},autocompleteGroupMenu:function(ul,items){var self=this,category=null,sortedItems=items.sort(function(a,b){return a.category.localeCompare(b.category)});$.each(sortedItems,function(index,item){item.category!=category&&(category=item.category,ul.append("<li class='ui-autocomplete-group'>"+category+"</li>")),self._renderItemData(ul,item)})},bindEvents:function(){var thisView=this,$document=$(window.document);$document.trigger("ptpb:dialog:bindEvents:before",thisView),thisView.dependencies(),thisView.mediaUploads(),thisView.icons(),thisView.chosenDropDowns(),thisView.fontDropDowns(),thisView.toggles(),thisView.colorPickers(),thisView.rangeSliders(),thisView.animationPreview(),this.$(".column-layouts li").on("click",function(){$("#pt-pb-insert-columns").hasClass("update-columns")&&window.confirm(ptPbOptions.i18n.resize_columns)?(thisView.model.trigger("ptpb:update:row",{layout:$(this).data("layout").replace(/ /g,"").split(",")}),thisView.model.unset("update")):thisView.model.trigger("ptpb:add:row",{layout:$(this).data("layout").replace(/ /g,"").split(",")}),thisView.triggerCancel()}),this.$("#pt-pb-insert-modules").on("click",".module-type",function(){thisView.model.trigger("ptpb:add:module",$(this).data()),thisView.triggerCancel()}),thisView.$("div.pt-tab-pane").on("pt-tab:open",function(){ptPbApp.modulesHeight(),thisView.googleMap()}),$document.trigger("ptpb:dialog:bindEvents:after",thisView)},dependencies:function(){var thisView=this,deps={};thisView.$(".pt-pb-option[data-dependency]").each(function(){var $t=$(this).hide(),dependency=$t.data("dependency");$.each(dependency.split(","),function(i,d){d=$.trim(d),deps[d]=deps[d]||[],deps[d].push($t)})}),$.each(deps,function(d,inputs){var $dep=thisView.$('.pt-pb-option :input[name="'+d+'"]');$dep.on("change keyup keypress paste",function(e){$.extend(thisView.unSavedData,$dep.serializeObject()),$.each(inputs,function(i,input){try{var cond="<%= "+input.data("condition")+" %>";"true"==_.template(cond)(thisView.unSavedData)?input.show():input.hide()}catch(e){console&&console.error&&console.error(e)}})}).trigger("keyup")})},mediaUploads:function(){this.$(".pt-pb-upload-field").each(function(){var el=$(this);""!==el.val()?(el.siblings(".pt-pb-upload-button").hide(),el.siblings(".pt-pb-remove-upload-button").show(),el.siblings(".screenshot").empty().append('<img src="'+el.val()+'">').show()):(el.siblings(".pt-pb-upload-button").show(),el.siblings(".pt-pb-remove-upload-button").hide())}),this.$(".pt-pb-remove-upload-button").on("click",function(event){ptPbApp.upload.removeFile($(event.target).parent())}),this.$(".pt-pb-upload-button").on("click",function(event){ptPbApp.upload.addFile(event)})},icons:function(){this.$(".pt-pb-icon-select").click(function(){var $select=$(this);ptPbApp.app.vent.trigger("ptpb:icons:show",{select:$select})}),this.$(".pt-pb-icon-delete").click(function(){var $option=$(this).closest(".pt-pb-option-container");$option.children(".pt-pb-icon").val("").trigger("change"),$option.children(".icon-preview").html("")})},chosenDropDowns:function(){this.$chosens=this.$("select.chosen-select:not(.font-select)").chosen({search_contains:!0,width:"420px"}).on("change",function(e,params){params&&params.deselected&&$(this).find('option[value="'+params.deselected+'"]').prop("selected",!1)}).filter("[multiple]")},fontDropDowns:function(){var thisView=this;this.$("select.font-select").each(function(){var $f=$(this),name=$f.attr("name"),varName=name.replace("_f","_v"),$v=$f.closest(".pt-pb-option").next().find('select[name="'+varName+'"]');$v.val(thisView.model.get(varName)),$f.html(ptPbOptions.fonts).val(thisView.model.get(name)||"").on("change",function(){var $t=$(this),selected=$t.find("option:selected"),vars=selected.length>0?selected.attr("data-variants").split(","):[];$v.length>0&&vars.length>0&&($v.empty(),_.each(vars,function(v){$v.append('<option value="'+v+'">'+v.toProperCase()+"</option>")}),$v.children("option[value="+thisView.model.get(varName)+"]").length>0&&$v.val(thisView.model.get(varName)))}).chosen({search_contains:!0,width:"340px"}).trigger("change"),$f.is("[multiple]")&&thisView.$chosens.add($f)})},toggles:function(){this.$("a.pt-pb-toggle-btn").on("click",function(e){e.preventDefault();var $t=$(this);$t.toggleClass("active"),$t.children("input").val($t.hasClass("active")?1:0)})},colorPickers:function(){this.$(".pt-pb-color").wpColorPicker({change:function(event,ui){$(event.target).trigger("keyup")},clear:function(event){$(event.target).prev(".pt-pb-color").trigger("keyup")}})},dateTimePickers:function(){this.$(".date-picker").datepicker(),this.$(".time-picker").timepicker(),this.$(".datetime-picker").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss"})},animationPreview:function(){this.$("select.js-animations").on("change",function(e){e.preventDefault();var $select=$(this),$preview=$select.siblings(".animation-preview");$preview.removeClass().addClass($select.val()+" animated animation-preview").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass().addClass("animation-preview")})})},rangeSliders:function(){this.$("div.pt-pb-option-container input.input-slider").each(function(){$(this).ionRangeSlider({type:"single",keyboard:!1,prettify_enabled:!1})}),this.$("div.pt-pb-option-container input.input-range-slider").each(function(){$(this).ionRangeSlider({type:"double",keyboard:!1,prettify_enabled:!1})})},googleMap:function(){function deletePoint(points,lat,lng){return _.filter(points,function(point){return point.lng!=lng&&point.lat!=lat})}var thisView=this,$map_el=thisView.$(".google-map-select:visible");if($map_el.length&&!$map_el.hasClass("map-loaded")){$map_el.addClass("map-loaded"),thisView.model.set("points",thisView.model.get("points")||[]);var $points=thisView.$("div#gmap-points"),pointsTmp=ptPbApp.template("module-googlemap-points");ptPbApp.app.vent.trigger("ptpb:map:init",{el:$map_el,points:thisView.model.get("points"),zoom:parseInt(thisView.model.get("zoom")),center:thisView.model.get("center"),styles:thisView.model.get("theme")}),$map_el.off("ptpb:map:point:selected").off("ptpb:map:point:deleted").on("ptpb:map:initialPlaces:added",function(){$points.html(pointsTmp({points:thisView.model.get("points")}))}),$map_el.on("ptpb:map:point:selected",function(e,point){var points=thisView.model.get("points");points=deletePoint(points,point.lat,point.lng),points.push(point),thisView.model.set("points",points),$points.html(pointsTmp({points:points}))}),$map_el.on("ptpb:map:point:deleted",function(e,point){var points=thisView.model.get("points");thisView.model.set("points",deletePoint(points,point.lat,point.lng)),$points.html(pointsTmp({points:thisView.model.get("points")}))}),thisView.$("[name=theme]").off("change").on("change",function(){gmap.setOptions({styles:GoogleMapThemes[$(this).val()]})})}}}),ptPbApp.Views.Layouts=ptPbApp.Views.Modal.extend({cancelEl:".close-model, .close-bbm-modal",template:ptPbApp.template("layout-manager"),layoutItems:ptPbApp.template("layout-items"),layout:null,events:{"show:layouts":"show","click #pt-pb-save-layout":"saveLayout","btn_click .layout-insert":"insertLayout","click .layout-delete":"deleteLayout","pt-tab:open #pt-layout-prebuilt":"onOpenPrebuiltTab","pt-tab:open #pt-layout-load":"onOpenLoadTab","pt-tab:open #pt-layout-save":"onOpenSaveTab","pt-tab:open #pt-layout-import":"onOpenImportTab"},onRender:function(cls){return ptPbApp.Views.Modal.prototype.onRender.call(this),this.importExport(),$("html").click(function(e){$(e.target).is(".layout-insert")||$(".pt-pb-dropdown").not(".hidden").addClass("hidden")}),this},initDropDownButtons:function(){this.$(".button-dropdown").each(function(){var $btn=$(this),$dropdown=$btn.siblings(".pt-pb-dropdown");$btn.off("click").on("click",function(e){e.preventDefault(),$dropdown.hasClass("hidden")?$dropdown.removeClass("hidden"):$dropdown.addClass("hidden")}),$dropdown.find("a").off("click").on("click",function(e){e.preventDefault(),$btn.data($(this).data()),$dropdown.addClass("hidden"),$btn.trigger("btn_click")})})},importExport:function(){var view=this,uploadUi=view.$(".import-upload-ui").hide(),uploader=new plupload.Uploader({runtimes:"html5,silverlight,flash,html4",browse_button:uploadUi.find(".file-browse-button").get(0),container:uploadUi.get(0),drop_element:uploadUi.find(".drag-upload-area").get(0),file_data_name:"ptpb_import_data",multiple_queues:!1,max_file_size:ptPbOptions.plupload.max_file_size,url:ptPbOptions.plupload.url,flash_swf_url:ptPbOptions.plupload.flash_swf_url,silverlight_xap_url:ptPbOptions.plupload.silverlight_xap_url,filters:[{title:ptPbOptions.plupload.filter_title,extensions:"json"}],multipart_params:{action:"ptpb_import_layout"},init:{PostInit:function(uploader){uploader.features.dragdrop&&uploadUi.addClass("has-drag-drop"),uploadUi.show().find(".progress-precent").css("width","0%")},FilesAdded:function(uploader){uploadUi.find(".file-browse-button").blur(),uploadUi.find(".drag-upload-area").removeClass("file-dragover"),uploadUi.find(".progress-bar").fadeIn("fast"),uploader.start()},UploadProgress:function(uploader,file){uploadUi.find(".progress-precent").css("width",file.percent+"%")},FileUploaded:function(uploader,file,response){var layout=JSON.parse(response.response);view.importedLayout=layout.layout?layout.layout:view.importedLayout,view.importedPageOptions=layout.pageOptions?layout.pageOptions:!1,uploadUi.find(".progress-bar").hide(),view.$("#import-complete").html(view.layoutItems({layouts:null,type:"import"})).show(),view.initDropDownButtons()},Error:function(){alert(ptPbOptions.plupload.error_message)}}});uploader.init(),uploadUi.find(".drag-upload-area").on("dragover",function(){$(this).addClass("file-dragover")}).on("dragleave",function(){$(this).removeClass("file-dragover")}),view.$(".pt-export").submit(function(e){var $t=$(this);$t.find("#ptpb_export_data").val(JSON.stringify({layout:ptPbApp.Sections.toJSON({clean:!0}),pageOptions:ptPbApp.PageOptions.toJSON({clean:!0})}))})},insertLayout:function(e){e.preventDefault();var layout,pageOptions,data,btn=$(e.target),item=btn.closest(".pt-pb-layout-item"),type=item.data("layoutType"),action=btn.data("value");return"db"===type?data=this.dbLayouts[item.data("layout")]:"prebuilt"===type?(layout=this.preLayouts[item.data("layout")],data=layout&&layout.layout?layout.layout:[],pageOptions=layout&&layout.pageOptions?layout.pageOptions:!1):"theme-prebuilt"===type?(layout=ptPbOptions.layouts[item.data("layout")],data=layout&&layout.layout?layout.layout:[],pageOptions=layout&&layout.pageOptions?layout.pageOptions:!1):(data=this.importedLayout,pageOptions=this.importedPageOptions),data="string"==typeof data?JSON.parse(data):data,"replace"!==action||window.confirm(ptPbOptions.i18n.replace_layout)?(ptPbApp.buildStage(data,action),pageOptions&&(ptPbApp.PageOptions=new ptPbApp.Models.PageOptions(pageOptions),ptPbApp.updatePBOptions()),void this.triggerCancel()):!1},saveLayout:function(e){e&&e.preventDefault();var layoutName=this.$("#pt-layout-name").val(),layout=JSON.stringify(ptPbApp.Sections.toJSON({clean:!0}));if(""===$.trim(layoutName))return void this.$(".pt-save-message").html(ptPbOptions.i18n.empty_layout_name).removeClass("updated error").addClass("error");if(""===$.trim(layout))return void this.$(".pt-save-message").html(ptPbOptions.i18n.empty_layout).removeClass("updated error").addClass("error");var view=this,data={action:"ptpb_save_layout",layout_name:layoutName,layout:layout};$.post(ptPbOptions.ajaxurl,data,function(result){var response=JSON.parse(result);view.$(".pt-save-message").html(response.message).removeClass("updated error").addClass(response.success?"updated":"error")},"html")},deleteLayout:function(e){e.preventDefault();var $c=this.$("#pt-layout-load"),item=$(e.target).closest(".pt-pb-layout-item");window.confirm(ptPbOptions.i18n.delete_layout)&&$.post(ptPbOptions.ajaxurl,{action:"ptpb_delete_layout",layout_name:item.data("layout")},function(result){result&&item.fadeOut(300,function(){0==item.siblings().length&&$c.append(ptPbOptions.i18n.empty_db_layouts).addClass("empty-layouts"),item.remove()})},"html")},onOpenPrebuiltTab:function(e){var $c=this.$("#pt-layout-prebuilt").empty().removeClass("error"),view=this;view.showLoader($c),$.get(ptPbOptions.ajaxurl,{action:"ptpb_get_prebuilt_layouts"},function(result){var response=JSON.parse(result);response.error?($c.addClass("error").append("<strong>"+ptPbOptions.i18n.prebuilt_get_error+"</strong><br/><br/>"),$c.append("Response Code: "+response.error.code),$c.append("<br/>Message: "+response.error.message).addClass("empty-layouts")):(view.preLayouts=response,$c.append(view.layoutItems({layouts:response,type:"prebuilt"}))),view.initDropDownButtons(),view.removeLoader($c)},"html")},onOpenLoadTab:function(e){var $c=this.$("#pt-layout-load").empty().removeClass("empty-layouts"),view=this;$.get(ptPbOptions.ajaxurl,{action:"ptpb_get_layout"},function(result){var response=JSON.parse(result);response.layouts&&!response.layouts.hasOwnProperty("length")?(view.dbLayouts=response.layouts,$c.append(view.layoutItems({layouts:response.layouts,type:"db"}))):$c.append(ptPbOptions.i18n.empty_db_layouts).addClass("empty-layouts"),view.initDropDownButtons()},"html")},onOpenSaveTab:function(e){this.$(".pt-save-message").empty().removeClass("updated error"),this.$("#pt-layout-name").val("")},onOpenImportTab:function(e){this.$("#import-complete").hide()}}),ptPbApp.Views.Icons=ptPbApp.Views.Modal.extend({template:ptPbApp.template("icon-picker"),events:{"click .icon-hover a":"insert","click .close-model":"triggerCancel","click .close-bbm-modal":"triggerCancel"},initialize:function(options){this.select=options.select,options.callback&&"function"==typeof options.callback&&(this.callback=options.callback)},insert:function(e){if(e.preventDefault(),this.callback){var rtn=this.callback.call(this,e);if(!rtn)return}var t=$(e.target),icon=t.is("a")?t:t.parent(),$option=this.select.closest(".pt-pb-option-container");icon=icon.attr("data-class"),$option.children(".pt-pb-icon").val(icon).trigger("change"),$option.children(".icon-preview").html('<i class="fa-5x '+icon+'"></i>'),this.triggerCancel()},attachFilter:function(){var active=this.$(".pt-tab-pane.open").attr("id").replace("pt-icons-",""),filter=ptPbApp.iconFilter.filters[active];filter.set("what","");var filterform=new ptPbApp.Views.FilterForm({model:filter}),filterView=new ptPbApp.Views.Filter({template:ptPbApp.template("icon-item"),collection:filter.filtered});this.$(".bbm-modal__topbar").find("form").remove(),this.$(".bbm-modal__topbar").append(filterform.render().el),this.$(".pt-tab-pane.open").html(filterView.render().el)},onRender:function(){var view=this;ptPbApp.Views.Modal.prototype.onRender.call(this),this.$("div.pt-tab-pane").on("pt-tab:open",function(){view.attachFilter()})}}),ptPbApp.Views.Actions=Backbone.View.extend({template:ptPbApp.template("actions"),className:"pt-pb-actions",layout:null,events:{"click #ptpb_fullscreen":"toggleFullscreen","click #ptpb_manage_layout":"layoutManager","click #ptpb_page_options":"pageOptions","click #ptpb_clear_layout":"clearLayout","click #ptpb_preview_page":"previewPage","click #ptpb_save_page":"savePage"},render:function(cls){return this.$el.html(this.template({})),$(document).on("heartbeat-send.autosave",function(event,data){ptPbApp.isPb()&&data.wp_autosave&&(data=_.extend(data,ptPbApp.autoSaveData()))}),this},layoutManager:function(e){e&&e.preventDefault(),ptPbApp.app.vent.trigger("ptpb:layouts:show",{model:this.model})},pageOptions:function(e){e&&e.preventDefault(),ptPbApp.app.vent.trigger("ptpb:options:show",{model:this.model})},clearLayout:function(e){e&&e.preventDefault(),window.confirm(ptPbOptions.i18n.clear_layout)&&ptPbApp.clearStage()},toggleFullscreen:function(e){e&&e.preventDefault();var $t=$("#ptpb_fullscreen"),$b=$("body"),$w=$(window),mh=$w.height()>840?$w.height()+30:840,$el=$("div#pt-pb-stage"),$s=$("#normal-sortables");$b.hasClass("pt-pb-fullscreen")?($t.text(ptPbOptions.i18n.full_screen),$("body").removeClass("pt-pb-fullscreen"),$el.unwrap()):($t.text(ptPbOptions.i18n.full_screen_exit),$el.wrap('<div class="pt-pb-fullscreen-wrap"></div>'),$el.parent().css({position:"absolute",left:"0",top:$el.offset().top+"px",width:$s.width()+"px",zIndex:9999}),$("body").addClass("pt-pb-fullscreen"),$el.parent().css({left:"-175px",top:0,right:0,width:$w.width()-60+"px",padding:"30px 25px",minHeight:mh+"px"}))},previewPage:function(e){e&&e.preventDefault(),$("#post-preview").trigger("click")},savePage:function(e){e&&e.preventDefault(),$("#publish").trigger("click")}}),ptPbApp.Views.Base=Marionette.View.extend({
$content:null,id:function(){return this.model.get("id")},edit:function(e){e&&e.preventDefault(),ptPbApp.app.vent.trigger("ptpb:edit:form",{model:this.model,template:this.editTemplate})}}),ptPbApp.Views.Section=ptPbApp.Views.Base.extend({template:ptPbApp.template("section"),editTemplate:"section-edit",className:"pt-pb-section grid",events:{"click .pt-pb-section-toggle":"toggleSection","click .pt-pb-settings-section":"edit","click .pt-pb-clone-section":"cloneSection","click .pt-pb-remove":"removeSection","click .pt-pb-insert-column":"insertRow"},initialize:function(options){this.model.on("remove",this.remove,this),this.model.on("change",this.update,this),this.model.on("change:label",this.updateLabel,this)},render:function(cls){return this.$el.html(this.template(this.model.toJSON())),this.$content=this.$(".pt-pb-content"),this.renderRows(),this},renderRows:function(){return this.$content.append(new ptPbApp.Views.Rows({collection:this.model.rows}).render().el),this},updateLabel:function(e){this.$(".pt-pb-section-label").text(this.model.get("label"))},cloneSection:function(e){e&&e.preventDefault(),ptPbApp.Sections.add(_.extend(this.model.toJSON(),{id:null}),{parse:!0})},removeSection:function(e,confirm){e&&e.preventDefault(),(confirm||window.confirm(ptPbOptions.i18n.remove_section))&&this.model.trigger("destroy",this.model)},toggleSection:function(e){e&&e.preventDefault();var $this=$(e.target),$head=$this.closest(".pt-pb-header"),$body=$head.siblings(".pt-pb-content-wrap");void 0===$body.css("display")||"block"===$body.css("display")?$body.slideUp(400,function(){$head.addClass("close")}):$body.slideDown(400,function(){$head.removeClass("close")})},insertRow:function(e){e&&e.preventDefault(),ptPbApp.app.vent.trigger("ptpb:insert:row",{model:this.model,row:!1,template:"insert-row"})}}),ptPbApp.Views.Sections=Marionette.CollectionView.extend({childView:ptPbApp.Views.Section,behaviors:{sortable:{containment:"parent",behaviorClass:ptPbApp.Behaviors.Sortable}}}),ptPbApp.Views.Row=ptPbApp.Views.Base.extend({template:ptPbApp.template("row"),editTemplate:"row-edit",className:"pt-pb-row clearfix",events:{"click .pt-pb-settings-row":"edit","click .pt-pb-settings-columns":"update","click .pt-pb-remove-row":"removeRow","click .pt-pb-row-toggle":"toggleRow","click .pt-pb-clone-row":"cloneRow"},initialize:function(options){this.model.on("remove",this.remove,this).on("change:label",this.adminLabel,this)},render:function(cls){return this.$el.html(this.template(this.model.toJSON())),this.$content=this.$(".pt-pb-row-content"),this.renderColumns(),this},renderColumns:function(){return this.$content.append(new ptPbApp.Views.Columns({collection:this.model.columns}).render().el),this},adminLabel:function(model,value){this.$(".pt-pb-row-label").text(value)},toggleRow:function(e){e&&e.preventDefault();var $this=$(e.target),$head=$this.closest(".pt-pb-row-header"),$body=$head.siblings(".pt-pb-row-content");void 0===$body.css("display")||"block"===$body.css("display")?$body.slideUp(400,function(){$head.addClass("close")}):$body.slideDown(400,function(){$head.removeClass("close")})},removeRow:function(e,confirm){e&&e.preventDefault(),(confirm||window.confirm(ptPbOptions.i18n.remove_row))&&this.model.trigger("destroy",this.model)},cloneRow:function(e,ind){e&&e.preventDefault(),ind=ind||this.model.collection.indexOf(this.model),this.model.collection.parent.trigger("ptpb:clone:row",this.model.toJSON(),ind)},update:function(e){e&&e.preventDefault(),this.model.set("update",!0),ptPbApp.app.vent.trigger("ptpb:update:row",{model:this.model,row:this.model,template:"insert-row"})}}),ptPbApp.Views.Rows=Marionette.CollectionView.extend({childView:ptPbApp.Views.Row,className:"pt-pb-content-inner",behaviors:{sortable:{behaviorClass:ptPbApp.Behaviors.Sortable,connectWith:".pt-pb-content-inner",axis:"y"}}}),ptPbApp.Views.Column=ptPbApp.Views.Base.extend({template:ptPbApp.template("column"),editTemplate:"column-edit",className:function(){return"pt-pb-column pt-pb-col-"+this.model.get("type")},events:{"click .save-column":"save","click .pt-pb-settings-column":"edit","click .pt-pb-insert-module":"insert"},render:function(cls){return this.$el.html(this.template(this.model.toJSON())),this.$content=this.$(".pt-pb-column-content"),this.renderModules(),this},renderModules:function(){return this.$content.append(new ptPbApp.Views.Modules({collection:this.model.modules}).render().el),this},insert:function(e){e&&e.preventDefault(),ptPbApp.app.vent.trigger("ptpb:insert:module",{model:this.model,template:"insert-module"})}}),ptPbApp.Views.Columns=Marionette.CollectionView.extend({childView:ptPbApp.Views.Column,className:"pt-pb-row-content-inner clearfix",behaviors:{sortable:{behaviorClass:ptPbApp.Behaviors.Sortable,containment:"parent",start:function(e,ui){var col=ui.item.attr("class").replace(/ ?pt-pb-column ?/,"");ui.placeholder.addClass(col).html('<div class="placeholder-inner" style="height:'+ui.item.height()+"px;width:"+(ui.item.width()-8)+'px;"></div>')}}}}),ptPbApp.Views.Module=ptPbApp.Views.Base.extend({$content:null,id:function(){return this.model.get("id")},className:"pt-pb-module-preview",events:{"click .edit-module > .edit":"edit","click .save-module":"save","click .edit-module > .remove":"delete","click .edit-module > .clone":"clone","click .pt-pb-insert-item":"insert"},initialize:function(){this.listenTo(this.model,"remove",this.remove,this),this.listenTo(this.model,"change",this.render,this);var tmpl="widget"===this.model.get("type")||this.model.get("type")in ptPbOptions.formFields.modules?"module-"+this.model.get("type"):"no-module";this.template=ptPbApp.template(tmpl),this.editTemplate=tmpl+"-edit"},render:function(cls){this.$el.html(this.template(this.model.toJSON())),this.$content=this.$('input[name="content"]'),(this.model.get("hasItems")&&this.model.items||this.model.items&&this.model.items.length>0)&&(this.model.items.each(function(item){item.get("type")||item.set("type",this.model.get("type")),item.get("label")||item.set("label",item.get("title")||"Item")},this),this.listenTo(this.model.items,"add remove update change",this.reloadMasonry,this),this.$(".content-preview .item-content-wrap").html(new ptPbApp.Views.Items({collection:this.model.items}).render().el));var $masonry=this.$("div.masonry-grid");return $masonry.imagesLoaded(function(){$masonry.masonry({itemSelector:"div.pt-pb-item-preview"})}),this},"delete":function(e,confirm){e&&e.preventDefault(),(confirm||window.confirm(ptPbOptions.i18n.remove_module))&&this.model.trigger("destroy",this.model,this.model.collection)},clone:function(e,ind){e&&e.preventDefault(),ind=ind||this.model.collection.indexOf(this.model),this.model.collection.parent.trigger("ptpb:clone:module",this.model.toJSON(),++ind)},insert:function(e){e&&e.preventDefault(),this.model.add({})},reloadMasonry:function(){this.$("div.masonry-grid").masonry("reload")}}),ptPbApp.Views.Modules=Marionette.CollectionView.extend({childView:ptPbApp.Views.Module,className:"pt-pb-column-content-inner",behaviors:{sortable:{behaviorClass:ptPbApp.Behaviors.Sortable,connectWith:".pt-pb-column-content-inner",over:function(event,ui){ui.item.css("width",ui.placeholder.closest(".pt-pb-column").width()-20+"px")}}}}),ptPbApp.Views.Item=ptPbApp.Views.Base.extend({$content:null,id:function(){return this.model.get("id")},className:"pt-pb-item-preview",events:{"click .edit-module-item > .edit":"edit","click .save-module-item":"save","click .edit-module-item > .remove":"delete","click .edit-module-item > .clone":"clone"},initialize:function(){this.model.on("remove",this.remove,this),this.model.on("change",this.render,this);var tmpl="module-"+this.model.get("type")+"-item";this.template=ptPbApp.template(tmpl),this.editTemplate=tmpl+"-edit"},render:function(cls){return this.$el.html(this.template(this.model.toJSON())),this.$content=this.$('input[name="content"]'),this},"delete":function(e,confirm){e&&e.preventDefault(),(confirm||window.confirm(ptPbOptions.i18n.remove_module))&&this.model.trigger("destroy",this.model,this.model.collection)},clone:function(e,ind){e&&e.preventDefault(),ind=ind||this.model.collection.indexOf(this.model),this.model.collection.parent.trigger("ptpb:clone:item",this.model.toJSON(),++ind)}}),ptPbApp.Views.Items=Marionette.CollectionView.extend({childView:ptPbApp.Views.Item,className:"pt-pb-item-content",behaviors:{sortable:{behaviorClass:ptPbApp.Behaviors.Sortable}}})}(window,Backbone,jQuery,_,ptPbApp);var ptPbApp=ptPbApp||{};!function($,ptPbApp){"use strict";ptPbApp.isPb=function(){return ptPbOptions&&ptPbOptions.isPb&&1==ptPbOptions.isPb},ptPbApp.toggleBuilder=function(e){e&&e.preventDefault(),"none"===ptPbApp.cache.$builder.css("display")?(ptPbApp.cache.$toggle.text(ptPbOptions.i18n.editor_text),ptPbApp.cache.$mceEditor.hide(),ptPbApp.cache.$builder.show(),ptPbApp.cache.$isPb.val(1)):window.confirm(ptPbOptions.i18n.default_editor)&&(ptPbApp.cache.$toggle.text(ptPbOptions.i18n.builder_text),ptPbApp.cache.$builder.hide(),ptPbApp.cache.$mceEditor.show(),ptPbApp.cache.$isPb.val(0),setTimeout(function(){try{"undefined"!=typeof window.switchEditors&&window.switchEditors.go("content",ptPbApp.getEditorMode()),window.wpActiveEditor="content",void 0!==tinyMCE.get("content")?tinyMCE.get("content").setContent(ptPbApp.cache.content):ptPbApp.cache.$content.val(ptPbApp.cache.content)}catch(e){console&&console.error&&console.error(e)}},100))},ptPbApp.updatePBOptions=function(){var oldVal=ptPbApp.cache.$pbOptions.val(),newVal=JSON.stringify(ptPbApp.PageOptions.toJSON({clean:!0}));oldVal!==newVal&&(ptPbApp.cache.$pbOptions.val(newVal),ptPbApp.isPb()&&ptPbApp.cache.$content.val((new Date).valueOf()))},ptPbApp.updatePBContent=function(){var oldVal=ptPbApp.cache.$pbData.val(),newVal=JSON.stringify(ptPbApp.Sections.toJSON({clean:!0}));oldVal!==newVal&&(ptPbApp.cache.$pbData.val(newVal),ptPbApp.isPb()&&ptPbApp.cache.$content.val((new Date).valueOf()))},ptPbApp.autoSaveData=function(){return{pt_is_pb:ptPbApp.cache.$isPb.val(),ptpb_data:ptPbApp.cache.$pbData.val(),ptpb_options:ptPbApp.cache.$pbOptions.val(),"pt-pb-nonce":$("#pt-pb-nonce").val()}},ptPbApp.buildStage=function(layout,action){if("replace"==action&&ptPbApp.clearStage(),-1!==$.inArray(action,["append","replace"]))_.each(layout,function(section){ptPbApp.Sections.add(section,{parse:!0})});else if("prepend"==action){var i=0;_.each(layout,function(section){ptPbApp.Sections.add(section,{parse:!0,at:i}),i++})}},ptPbApp.clearStage=function(){ptPbApp.Sections.reset()},ptPbApp.isVisualEditor=function(){return $("#wp-ptpb_editor-wrap").hasClass("tmce-active")},ptPbApp.getContent=function(){return ptPbApp.isVisualEditor()?tinyMCE.get("ptpb_editor").getContent():$("#ptpb_editor").val()},ptPbApp.setContent=function(content){ptPbApp.isVisualEditor()&&void 0!==tinyMCE.get("ptpb_editor")?tinyMCE.get("ptpb_editor").setContent(content):$("#ptpb_editor").val(content)},ptPbApp.createEditor=function(el){el&&0!==el.length&&el.is(":input")&&(el.after(ptPbApp.cache.editorHtml),setTimeout(function(){"undefined"!=typeof window.switchEditors&&window.switchEditors.go("ptpb_editor",ptPbApp.getEditorMode()),window.wpActiveEditor="ptpb_editor",ptPbApp.setContent(el.val())},100))},ptPbApp.removeEditor=function(){if("undefined"!=typeof window.tinyMCE){try{window.tinyMCE.execCommand("mceRemoveEditor",!1,"ptpb_editor")}catch(e){}"undefined"!=typeof window.tinyMCE.get("ptpb_editor")&&(window.tinyMCE.remove("#ptpb_editor"),$("#wp-ptpb_editor-wrap").remove())}},ptPbApp.getEditorMode=function(){var mode="tinymce";return"html"===getUserSetting("editor")&&(mode="html"),mode},ptPbApp.scrollTo=function(top){ptPbApp.cache.$html.stop().animate({scrollTop:top},600)},ptPbApp.paneName=function(pane){return pane.replace(" ","").toLowerCase()},ptPbApp.upload={addFile:function(event){var frame,$el=$(event.target),$parent=$el.parent();return event.preventDefault(),frame?void frame.open():(frame=wp.media({title:$el.data("choose"),button:{text:$el.data("update"),close:!1}}),frame.on("select",function(){var attachment=frame.state().get("selection").first().toJSON();frame.close(),$parent.find(".pt-pb-upload-field").val(attachment.url).trigger("change"),$parent.find(".pt-pb-upload-field-id").val(attachment.id).trigger("change"),"image"===attachment.type&&$parent.find(".screenshot").empty().hide().append('<img src="'+attachment.url+'">').slideDown("fast"),$parent.find(".pt-pb-upload-button").hide(),$parent.find(".pt-pb-remove-upload-button").show()}),void frame.open())},removeFile:function(selector){selector.find(".pt-pb-upload-field").val("").trigger("change"),selector.find(".screenshot").slideUp(200,function(){$(this).empty()}),selector.find(".pt-pb-remove-upload-button").hide(),selector.find(".pt-pb-upload-button").show()}},ptPbApp.modulesHeight=function(){if(ptPbApp.cache.$modules.is(":visible")){var modules=ptPbApp.cache.$modules.find("ul.column-modules");modules.each(function(){ptPbApp.setModulesHeight($(this).find(".column-module > div.module-type"))})}},ptPbApp.setModulesHeight=function(modules){for(var pdng=parseInt(modules.first().parent().css("padding")),colCnt=10==pdng?4:9==pdng?3:2,cnt=Math.ceil(modules.length/colCnt),i=0;cnt>i;i++){var maxHt=0,start=i*colCnt,slice=modules.slice(start,start+colCnt);slice.each(function(){var $t=$(this).removeAttr("style");maxHt=$t.outerHeight()>maxHt?$t.outerHeight():maxHt}),slice.css("height",maxHt+"px")}},ptPbApp.fixedHeader=function(){ptPbApp.cache.$builder.offset().top+65<ptPbApp.cache.$window.scrollTop()?ptPbApp.cache.$builder.addClass("fixed-options"):ptPbApp.cache.$builder.removeClass("fixed-options")},ptPbApp.topBar=function(){$(document).on("pt-tab:open","div.pt-tab-pane",function(){var $t=$(this),h=$t.closest(".bbm-modal__section").find(".pt-pb-top-bar").outerHeight();$t.css("top",++h+"px")})},ptPbApp.GoogleMaps={init:function(options){if(options.el&&options.el.length&&0!==options.el.length&&!(options.el.find(".gm-style").length>0)){var centerLatLng=new google.maps.LatLng(40.698726437081305,-74.00508475781245);if(options.center){var center=options.center.split(",");2===center.length?centerLatLng=new google.maps.LatLng(center[0],center[1]):options.length>0&&(centerLatLng=new google.maps.LatLng(parseFloat(options[0].lat),parseFloat(options[0].lng)))}var styles;options.styles&&GoogleMapThemes[options.styles]&&(styles=GoogleMapThemes[options.styles]),options.el.mapsed({searchOptions:{enabled:!0,geoSearch:"{POSITION}",placeholder:"Search ..."},showOnLoad:options.points||[],styles:styles,mapOptions:{zoom:options.zoom||12,center:centerLatLng},onSelect:function(m,placeToAdd){return options.el.trigger("ptpb:map:point:selected",placeToAdd),!0},onSave:function(m,placeToSave){return options.el.trigger("ptpb:map:point:selected",placeToSave),!0},onDelete:function(mapsed,placeToDelete){return options.el.trigger("ptpb:map:point:deleted",placeToDelete),!0},getHelpWindow:function(){var html="<div class='mapsed-help'><h3>Find a Location</h3><ol><li>Simply use the <strong>search</strong> box to find your location.</li><li>Click to set a marker on your desired location</li><li>Once a marker is set, click on the marker to open the popup, click Edit to edit the details and once edited, click Select in the popup to choose the location</li></ol></div>";return html}})}},addPoint:function(){}}}(jQuery,ptPbApp),jQuery(document).ready(function($){ptPbApp.app=new Backbone.Marionette.Application;var dialog=Backbone.Marionette.LayoutView.extend({template:_.template($("#modals-template").html()),regions:{edit:{selector:"#ptpb_edit_dialog",regionClass:Backbone.Marionette.Modals},columns:{selector:"#ptpb_columns_dialog",regionClass:Backbone.Marionette.Modals},modules:{selector:"#ptpb_modules_dialog",regionClass:Backbone.Marionette.Modals},layouts:{selector:"#ptpb_layouts_dialog",regionClass:Backbone.Marionette.Modals},icons:{selector:"#ptpb_icons_dialog",regionClass:Backbone.Marionette.Modals}}}),stage=Backbone.Marionette.LayoutView.extend({template:ptPbApp.template("layout"),regions:{actions:"#ptpb_actions",main:"#pt-pb-main-container"}}),appDialog=new dialog,appLayout=new stage;$("body").append(appDialog.render().el),$("#pt-pb-main-wrap").append(appLayout.render().el),ptPbApp.app.vent.on("ptpb:edit:form",function(options){appDialog.edit.show(new ptPbApp.Views.Dialog(options))}),ptPbApp.app.vent.on("ptpb:insert:row",function(options){appDialog.columns.show(new ptPbApp.Views.Dialog(options))}),ptPbApp.app.vent.on("ptpb:update:row",function(options){appDialog.columns.show(new ptPbApp.Views.Dialog(options))}),ptPbApp.app.vent.on("ptpb:insert:module",function(options){var modules=new Backbone.Collection(_.map(ptPbOptions.formFields.modules,function(val,key){return val.slug=key,val}));modules.add(_.map(ptPbOptions.widgets,function(val,key){return val.slug="widget",val}));var $allModTab,moduleFilter=new ptPbApp.Models.Filter({collection:modules,where:["label","slug","description"]});options.filter={template:"module-items",collection:moduleFilter.filtered,model:moduleFilter,appendTo:"#pt-pb-all-modules",formAppendTo:".bbm-modal__topbar"},moduleFilter.on("change",function(){$allModTab||($allModTab=$("#pt-pb-all-modules")),$allModTab.is(":visible")||$("#pt-pb-insert-modules .pt-topbar-tabs li a").filter(function(t,el){return"#pt-pb-all-modules"===$(el).attr("href")}).trigger("click")}),appDialog.modules.show(new ptPbApp.Views.Dialog(options))}),ptPbApp.app.vent.on("ptpb:insert:item",function(options){appDialog.modules.show(new ptPbApp.Views.Dialog(options))}),ptPbApp.app.vent.on("ptpb:layouts:show",function(options){appDialog.layouts.show(new ptPbApp.Views.Layouts(options))}),ptPbApp.app.vent.on("ptpb:options:show",function(options){var view=new ptPbApp.Views.Base({model:ptPbApp.PageOptions});view.editTemplate="page-options-edit",view.edit()}),ptPbApp.iconFilter={},ptPbApp.iconFilter.icons={},ptPbApp.iconFilter.filters={},_.each(ptPbOptions.icons,function(list,family){var slug=ptPbApp.slug(family);ptPbApp.iconFilter.icons[slug]=new Backbone.Collection(_.map(list,function(val,key){return{name:key,cls:val}})),ptPbApp.iconFilter.filters[slug]=new ptPbApp.Models.Filter({collection:ptPbApp.iconFilter.icons[slug],where:["name"]})}),ptPbApp.app.vent.on("ptpb:icons:show",function(options){appDialog.icons.show(new ptPbApp.Views.Icons(options))}),ptPbApp.app.vent.on("ptpb:map:init",function(options){ptPbApp.GoogleMaps.init(options)}),ptPbApp.getSectionNum=function(){return["ptpb_s",++ptPbApp.sectionNum].join("")},ptPbApp.app.addInitializer(function(options){ptPbApp.sectionNum=0,ptPbApp.cache.editorHtml=ptPbApp.cache.$hiddenEditor.html(),ptPbApp.cache.$hiddenEditor.remove(),ptPbApp.isPb()&&ptPbApp.toggleBuilder(),appLayout.actions.show(new ptPbApp.Views.Actions),ptPbApp.Sections=new ptPbApp.Collections.Section,_.each(ptPbOptions.data,function(section){section.id&&delete section.id,ptPbApp.Sections.add(section,{parse:!0})}),ptPbApp.PageOptions=new ptPbApp.Models.PageOptions(ptPbOptions.pageOptions||{}),ptPbApp.updatePBOptions(),appLayout.main.show(new ptPbApp.Views.Sections({collection:ptPbApp.Sections}));var grpdModules=_.pick(ptPbOptions.formFields.modules,function(val,key){return val.tabPanes&&_.isArray(val.tabPanes)});ptPbApp.modulePanes={},_.each(grpdModules,function(module,slug){_.each(module.tabPanes,function(pane){ptPbApp.modulePanes[pane]=ptPbApp.modulePanes[pane]||{},ptPbApp.modulePanes[pane][slug]=module})}),ptPbApp.layoutPanes={},_.each(ptPbOptions.layouts,function(layout,name){var pane=layout.tab_pane||"Theme Prebuilt";ptPbApp.layoutPanes[pane]=ptPbApp.layoutPanes[pane]||{},ptPbApp.layoutPanes[pane][name]=_.isArray(layout)?layout:[layout]}),$("#ptpb_loader").fadeOut()}),ptPbApp.cache={$window:$(window),$container:$("#pt-pb-main-container"),$pageTemplate:$("#page_template"),$hiddenEditor:$("#pt-pb-editor-hidden"),editorHtml:"",sectionNum:0,$html:$("html, body"),$builder:$("#pt-pb-stage"),$mceEditor:$("#postdivrich"),$toggle:$("#pt_enable_pb"),$isPb:$("#pt_is_pb"),$modules:$("#ptpb_modules_dialog"),$columns:null,$pbData:$("#ptpb_data"),$pbOptions:$("#ptpb_options"),$content:$("#content"),content:$("#content").val()},ptPbApp.cache.$toggle.on("click",ptPbApp.toggleBuilder),ptPbApp.cache.$container.on("click",".pt-pb-module-toggle",function(e){e.preventDefault(),$(this).closest(".module-controls").siblings(".content-preview, .slide-content-preview").slideToggle(300,function(){$(this).siblings(".module-controls").toggleClass("close")})}),$(".pt-pb-insert-section").on("click",function(e){e.preventDefault(),ptPbApp.Sections.add({})}),ptPbApp.cache.$window.resize(ptPbApp.modulesHeight),ptPbApp.cache.$window.scroll(ptPbApp.fixedHeader),ptPbApp.topBar(),ptPbApp.app.start()});